{"version":3,"file":"errorhandler.js","sources":["../../src/errorhandler.ts"],"sourcesContent":["import { captureException } from '@sentry/core';\nimport { consoleSandbox } from '@sentry/utils';\n\nimport type { ViewModel, Vue, VueOptions } from './types';\nimport { formatComponentName, generateComponentTrace } from './vendor/components';\n\ntype UnknownFunc = (...args: unknown[]) => void;\n\nexport const attachErrorHandler = (app: Vue, options: VueOptions): void => {\n  const { errorHandler: originalErrorHandler, warnHandler, silent } = app.config;\n\n  app.config.errorHandler = (error: Error, vm: ViewModel, lifecycleHook: string): void => {\n    const componentName = formatComponentName(vm, false);\n    const trace = vm ? generateComponentTrace(vm) : '';\n    const metadata: Record<string, unknown> = {\n      componentName,\n      lifecycleHook,\n      trace,\n    };\n\n    if (options.attachProps && vm) {\n      // Vue2 - $options.propsData\n      // Vue3 - $props\n      if (vm.$options && vm.$options.propsData) {\n        metadata.propsData = vm.$options.propsData;\n      } else if (vm.$props) {\n        metadata.propsData = vm.$props;\n      }\n    }\n\n    // Capture exception in the next event loop, to make sure that all breadcrumbs are recorded in time.\n    setTimeout(() => {\n      captureException(error, {\n        captureContext: { contexts: { vue: metadata } },\n        mechanism: { handled: false },\n      });\n    });\n\n    // Check if the current `app.config.errorHandler` is explicitly set by the user before calling it.\n    if (typeof originalErrorHandler === 'function' && app.config.errorHandler) {\n      (originalErrorHandler as UnknownFunc).call(app, error, vm, lifecycleHook);\n    }\n\n    if (options.logErrors) {\n      const hasConsole = typeof console !== 'undefined';\n      const message = `Error in ${lifecycleHook}: \"${error && error.toString()}\"`;\n\n      if (warnHandler) {\n        (warnHandler as UnknownFunc).call(null, message, vm, trace);\n      } else if (hasConsole && !silent) {\n        consoleSandbox(() => {\n          // eslint-disable-next-line no-console\n          console.error(`[Vue warn]: ${message}${trace}`);\n        });\n      }\n    }\n  };\n};\n"],"names":[],"mappings":";;;;MAQa,kBAAmB,GAAE,CAAC,GAAG,EAAO,OAAO,KAAuB;AAC3E,EAAE,MAAM,EAAE,YAAY,EAAE,oBAAoB,EAAE,WAAW,EAAE,MAAO,EAAA,GAAI,GAAG,CAAC,MAAM;;AAEhF,EAAE,GAAG,CAAC,MAAM,CAAC,YAAa,GAAE,CAAC,KAAK,EAAS,EAAE,EAAa,aAAa,KAAmB;AAC1F,IAAI,MAAM,gBAAgB,mBAAmB,CAAC,EAAE,EAAE,KAAK,CAAC;AACxD,IAAI,MAAM,KAAM,GAAE,EAAG,GAAE,sBAAsB,CAAC,EAAE,CAAE,GAAE,EAAE;AACtD,IAAI,MAAM,QAAQ,GAA4B;AAC9C,MAAM,aAAa;AACnB,MAAM,aAAa;AACnB,MAAM,KAAK;AACX,KAAK;;AAEL,IAAI,IAAI,OAAO,CAAC,WAAY,IAAG,EAAE,EAAE;AACnC;AACA;AACA,MAAM,IAAI,EAAE,CAAC,QAAA,IAAY,EAAE,CAAC,QAAQ,CAAC,SAAS,EAAE;AAChD,QAAQ,QAAQ,CAAC,SAAU,GAAE,EAAE,CAAC,QAAQ,CAAC,SAAS;AAClD,aAAa,IAAI,EAAE,CAAC,MAAM,EAAE;AAC5B,QAAQ,QAAQ,CAAC,SAAA,GAAY,EAAE,CAAC,MAAM;AACtC;AACA;;AAEA;AACA,IAAI,UAAU,CAAC,MAAM;AACrB,MAAM,gBAAgB,CAAC,KAAK,EAAE;AAC9B,QAAQ,cAAc,EAAE,EAAE,QAAQ,EAAE,EAAE,GAAG,EAAE,QAAS,EAAA,EAAG;AACvD,QAAQ,SAAS,EAAE,EAAE,OAAO,EAAE,OAAO;AACrC,OAAO,CAAC;AACR,KAAK,CAAC;;AAEN;AACA,IAAI,IAAI,OAAO,oBAAA,KAAyB,UAAA,IAAc,GAAG,CAAC,MAAM,CAAC,YAAY,EAAE;AAC/E,MAAM,CAAC,oBAAA,GAAqC,IAAI,CAAC,GAAG,EAAE,KAAK,EAAE,EAAE,EAAE,aAAa,CAAC;AAC/E;;AAEA,IAAI,IAAI,OAAO,CAAC,SAAS,EAAE;AAC3B,MAAM,MAAM,UAAW,GAAE,OAAO,OAAA,KAAY,WAAW;AACvD,MAAM,MAAM,OAAQ,GAAE,CAAC,SAAS,EAAE,aAAa,CAAC,GAAG,EAAE,KAAM,IAAG,KAAK,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC;;AAEjF,MAAM,IAAI,WAAW,EAAE;AACvB,QAAQ,CAAC,WAAA,GAA4B,IAAI,CAAC,IAAI,EAAE,OAAO,EAAE,EAAE,EAAE,KAAK,CAAC;AACnE,OAAM,MAAO,IAAI,cAAc,CAAC,MAAM,EAAE;AACxC,QAAQ,cAAc,CAAC,MAAM;AAC7B;AACA,UAAU,OAAO,CAAC,KAAK,CAAC,CAAC,YAAY,EAAE,OAAO,CAAC,EAAA,KAAA,CAAA,CAAA,CAAA;AACA,SAAA,CAAA;AACA;AACA;AACA,GAAA;AACA;;;;"}